# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

Personal dotfiles for macOS. Interactive setup wizard + traditional shell scripts.

## Setup

**Primary entry point:**
```bash
git clone https://github.com/lacymorrow/dotfiles.git ~/dotfiles
cd ~/dotfiles && ./setup.sh
```

**Fresh Mac (no git):**
```bash
curl -fsSL https://raw.githubusercontent.com/lacymorrow/dotfiles/main/setup.sh | bash
```

`setup.sh` (pure bash) installs prerequisites (Xcode CLT, Homebrew, Node.js), then launches an interactive Node.js wizard (`setup/index.mjs`) built with `@clack/prompts`.

**Individual scripts (still work standalone):**
```bash
./symlink_dotfiles.sh       # Symlink home/ → ~/
./brew.sh                   # Homebrew packages from Brewfile
./node.sh                   # NVM + Bun + global packages
./apply-macos-settings.sh   # macOS system defaults (parameterized)
```

## Architecture

```
~/dotfiles/
├── setup.sh                # Bash bootstrap → installs prereqs → launches wizard
├── setup/
│   ├── index.mjs           # Interactive wizard (@clack/prompts)
│   └── package.json        # Dependencies (picocolors, @clack/prompts)
├── home/                   # Dotfiles symlinked to ~/ (all start with .)
│   ├── .shell_common       # Shared login setup (POSIX) — Homebrew, NVM, Bun, sources dotfile modules
│   ├── .zprofile           # Zsh login shell: sources .shell_common + zsh plugins/completions
│   ├── .zshrc              # Zsh interactive shell: options, key bindings, Starship prompt
│   ├── .bash_profile       # Bash login shell: sources .shell_common + bash options/completions
│   ├── .bashrc             # Bash interactive shell: history, Starship prompt
│   ├── .gitconfig          # Git config (no personal info — uses [include] for ~/.gitconfig.local)
│   ├── .aliases            # Shell aliases (shared, zsh-only guards where needed)
│   ├── .functions          # Shell utility functions
│   ├── .exports            # Environment variables
│   ├── .docker_aliases     # Docker aliases/functions
│   ├── .vimrc              # Vim config
│   ├── .tmux.conf          # Tmux config (Ctrl-a prefix)
│   ├── starship.toml       # Starship prompt theme
│   └── ...                 # .npmrc, .curlrc, .inputrc, .editorconfig, etc.
├── symlink_dotfiles.sh     # Idempotent symlinker (skips correct links, backs up conflicts)
├── brew.sh                 # Homebrew install + brew bundle
├── node.sh                 # NVM + Node + Bun + global packages
├── apply-macos-settings.sh # macOS defaults (reads DOTFILES_COMPUTER_NAME, DOTFILES_WORK_MACHINE env vars)
├── Brewfile                # Declarative Homebrew dependencies
├── settings/               # App-specific settings (BetterSnapTool)
└── .ssh/                   # SSH config template
```

## Key Design Decisions

- **No personal info in tracked files.** Git user config goes in `~/.gitconfig.local` (generated by setup wizard, included via `[include]` in `.gitconfig`). Secrets go in `~/.secrets` (sourced by `.shell_common`).
- **Shell:** Zsh and Bash supported via shared `.shell_common`. Starship prompt. No Oh My Zsh.
- **Package manager:** Homebrew for everything (CLI + casks + App Store via `mas`).
- **Nix files exist** (`flake.nix`, `darwin-configuration.nix`, `home.nix`) as an experimental alternative but are not part of the main setup flow.
- **`apply-macos-settings.sh` is parameterized.** Pass computer name and work machine flag via env vars (`DOTFILES_COMPUTER_NAME`, `DOTFILES_WORK_MACHINE`), positional args, or it prompts interactively with sane defaults.

## Dotfile Loading Order (in .shell_common)

```
~/.path → ~/.exports → ~/.aliases → ~/.docker_aliases → ~/.functions → ~/.secrets → ~/.extra
```

All optional — missing files are silently skipped.

## Working with This Repository

- Edit files in `home/` — they're symlinked to `~/`, so changes take effect immediately
- Edit `Brewfile` then `brew bundle` to add packages
- Edit `apply-macos-settings.sh` for macOS defaults changes
- Re-run `./setup.sh` at any time — it's idempotent
